<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
<meta name="generator" content="pdoc3 0.11.1">
<title>mlb_simulator.models.model_utils API documentation</title>
<meta name="description" content="This module includes functions to help with fitting models, saving models/
model hyperparams, and evaluating models">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/13.0.0/sanitize.min.css" integrity="sha512-y1dtMcuvtTMJc1yPgEqF0ZjQbhnc/bFhyvIyVNb9Zk5mIGtqVaAB1Ttl28su8AvFMOY0EwRbAe+HCLqj6W7/KA==" crossorigin>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/13.0.0/typography.min.css" integrity="sha512-Y1DYSb995BAfxobCkKepB1BqJJTPrOp3zPL74AWFugHHmmdcvO+C48WLrUOlhGMc0QG7AE3f7gmvvcrmX2fDoA==" crossorigin>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:1.5em;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:2em 0 .50em 0}h3{font-size:1.4em;margin:1.6em 0 .7em 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .2s ease-in-out}a:visited{color:#503}a:hover{color:#b62}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900;font-weight:bold}pre code{font-size:.8em;line-height:1.4em;padding:1em;display:block}code{background:#f3f3f3;font-family:"DejaVu Sans Mono",monospace;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em 1em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul ul{padding-left:1em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js" integrity="sha512-D9gUyxqja7hBtkWpPWGt9wfbfaMGVt9gnyCvYa+jojwwPHLCzUm5i8rpk7vD7wNee9bA35eYIjobYPaQuKS1MQ==" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => {
hljs.configure({languages: ['bash', 'css', 'diff', 'graphql', 'ini', 'javascript', 'json', 'plaintext', 'python', 'python-repl', 'rust', 'shell', 'sql', 'typescript', 'xml', 'yaml']});
hljs.highlightAll();
})</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>mlb_simulator.models.model_utils</code></h1>
</header>
<section id="section-intro">
<p>This module includes functions to help with fitting models, saving models/
model hyperparams, and evaluating models</p>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="mlb_simulator.models.model_utils.balance_classes"><code class="name flex">
<span>def <span class="ident">balance_classes</span></span>(<span>X_train, X_test, y_train, y_test)</span>
</code></dt>
<dd>
<div class="desc"><p>Hit by pitch is a rare class. So, for batters with lower sample size,
occasionally there does not exist an occurence of this class within either
the test or training set. This method ensures there exists an instance of
each class in the training and test set. Of course not ideal, and this
is an area which can be drastically improved upon.</p></div>
</dd>
<dt id="mlb_simulator.models.model_utils.categorical_chisquare"><code class="name flex">
<span>def <span class="ident">categorical_chisquare</span></span>(<span>model, label_encoder, X_test, y_test)</span>
</code></dt>
<dd>
<div class="desc"><p>Run a hypothesis test that generated data is similar in dist to actual</p></div>
</dd>
<dt id="mlb_simulator.models.model_utils.categorical_model_pipeline"><code class="name flex">
<span>def <span class="ident">categorical_model_pipeline</span></span>(<span>model, data, target_col)</span>
</code></dt>
<dd>
<div class="desc"><p>Creates and returns a machine learning pipeline for categorical data using
XGBoost or other scikit-learn compatible models.</p>
<p>This function prepares the data by encoding the target column and applying
necessary transformations to the features. It constructs a pipeline that
includes preprocessing steps for numeric and categorical features and a
specified classification model.</p>
<p>:param model: The model class to be used for classification. It
should be compatible with scikit-learn pipelines (have a .fit,
.pred_proba method, etc) (class).
:param data: The input dataframe containing features and the
target column (pd.DataFrame).
:param target_col: The name of the target column in the dataframe (str).</p>
<p>:return: A tuple containing the following elements:
- model_pipeline: A scikit-learn pipeline with preprocessing
steps and the classifier (Pipeline).
- label_encoder: The label encoder fitted on the target
column (LabelEncoder).
- features: The feature columns after dropping the target
column (pd.DataFrame).
- target: The encoded target column (np.ndarray).</p></div>
</dd>
<dt id="mlb_simulator.models.model_utils.check_for_hyperparams"><code class="name flex">
<span>def <span class="ident">check_for_hyperparams</span></span>(<span>model_name, player_id)</span>
</code></dt>
<dd>
<div class="desc"><p>Check to see if up-to-date hyperparameters exist for desired model/player.</p>
<p>Model hyperparameters are saved to /models/model_name as
player_id-%Y%m%d.json and are set to "expire" every 90 days. Models are
saved as individual JSON files to avoid loading a huge JSON into memory
each time this is needed.</p>
<p>:param model_name: The name of the model, e.g., "pitch_outcome" (str).
:param player_id: The mlb_id of the player whose model is being fit (int).</p></div>
</dd>
<dt id="mlb_simulator.models.model_utils.classifier_report"><code class="name flex">
<span>def <span class="ident">classifier_report</span></span>(<span>model, label_encoder, X_test, y_test)</span>
</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="mlb_simulator.models.model_utils.compute_cat_loglik"><code class="name flex">
<span>def <span class="ident">compute_cat_loglik</span></span>(<span>X_train, y_train, y_test, target_col)</span>
</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="mlb_simulator.models.model_utils.compute_model_loglik"><code class="name flex">
<span>def <span class="ident">compute_model_loglik</span></span>(<span>y_pred_proba, y_test, target_col)</span>
</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="mlb_simulator.models.model_utils.get_default_batter_path"><code class="name flex">
<span>def <span class="ident">get_default_batter_path</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="mlb_simulator.models.model_utils.get_hyperparams"><code class="name flex">
<span>def <span class="ident">get_hyperparams</span></span>(<span>model_name, player_id, model, X, y)</span>
</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="mlb_simulator.models.model_utils.sample_predictions"><code class="name flex">
<span>def <span class="ident">sample_predictions</span></span>(<span>classifier, X)</span>
</code></dt>
<dd>
<div class="desc"><p>Generates a random sample of predictions given a classifier with a
predict_proba method and input features X.</p>
<p>This function uses the predicted probabilities from the classifier to
generate a sample of class predictions based on the probability
distribution.</p>
<p>:param classifier: A trained classifier that has a <code>predict_proba</code>
method (object).
:param X: The input features for which to generate predictions
(pd.DataFrame or np.ndarray).</p>
<p>:return: An array of sampled predictions based on the predicted
probabilities (np.ndarray).</p></div>
</dd>
<dt id="mlb_simulator.models.model_utils.save_hyperparams"><code class="name flex">
<span>def <span class="ident">save_hyperparams</span></span>(<span>model_name, player_id, hyperparams: dict)</span>
</code></dt>
<dd>
<div class="desc"><p>Save hyperparameters to a JSON file.</p>
<p>:param model_name: The name of the model being saved. Crucial to ensure
model gets saved to correct path (str).
:param player_id: The mlbid of the player whose model is being fit (int).
:param hyperparams: The hyperparameters to save (dict).</p></div>
</dd>
<dt id="mlb_simulator.models.model_utils.xgb_hyperparam_optimizer"><code class="name flex">
<span>def <span class="ident">xgb_hyperparam_optimizer</span></span>(<span>model, X, y)</span>
</code></dt>
<dd>
<div class="desc"><p>Optimizes hyperparameters for an XGBoost model using a grouped parameter
grid and log loss as the evaluation metric.</p>
<p>This function performs hyperparameter optimization for the given XGBoost
model by splitting the data into training and testing sets, then
iteratively searching through predefined groups of hyperparameters to find
the combination that yields the best log loss on the test set.</p>
<p>:param model: A scikit-learn pipeline object that includes an XGBoost
classifier (sklearn.pipeline.Pipeline).
:param X: The input features (pd.DataFrame or np.ndarray).
:param y: The target variable (pd.Series or np.ndarray).</p>
<p>:return: A dictionary containing the best hyperparameters found during the
optimization process (dict).</p></div>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="mlb_simulator.models" href="index.html">mlb_simulator.models</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="mlb_simulator.models.model_utils.balance_classes" href="#mlb_simulator.models.model_utils.balance_classes">balance_classes</a></code></li>
<li><code><a title="mlb_simulator.models.model_utils.categorical_chisquare" href="#mlb_simulator.models.model_utils.categorical_chisquare">categorical_chisquare</a></code></li>
<li><code><a title="mlb_simulator.models.model_utils.categorical_model_pipeline" href="#mlb_simulator.models.model_utils.categorical_model_pipeline">categorical_model_pipeline</a></code></li>
<li><code><a title="mlb_simulator.models.model_utils.check_for_hyperparams" href="#mlb_simulator.models.model_utils.check_for_hyperparams">check_for_hyperparams</a></code></li>
<li><code><a title="mlb_simulator.models.model_utils.classifier_report" href="#mlb_simulator.models.model_utils.classifier_report">classifier_report</a></code></li>
<li><code><a title="mlb_simulator.models.model_utils.compute_cat_loglik" href="#mlb_simulator.models.model_utils.compute_cat_loglik">compute_cat_loglik</a></code></li>
<li><code><a title="mlb_simulator.models.model_utils.compute_model_loglik" href="#mlb_simulator.models.model_utils.compute_model_loglik">compute_model_loglik</a></code></li>
<li><code><a title="mlb_simulator.models.model_utils.get_default_batter_path" href="#mlb_simulator.models.model_utils.get_default_batter_path">get_default_batter_path</a></code></li>
<li><code><a title="mlb_simulator.models.model_utils.get_hyperparams" href="#mlb_simulator.models.model_utils.get_hyperparams">get_hyperparams</a></code></li>
<li><code><a title="mlb_simulator.models.model_utils.sample_predictions" href="#mlb_simulator.models.model_utils.sample_predictions">sample_predictions</a></code></li>
<li><code><a title="mlb_simulator.models.model_utils.save_hyperparams" href="#mlb_simulator.models.model_utils.save_hyperparams">save_hyperparams</a></code></li>
<li><code><a title="mlb_simulator.models.model_utils.xgb_hyperparam_optimizer" href="#mlb_simulator.models.model_utils.xgb_hyperparam_optimizer">xgb_hyperparam_optimizer</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.11.1</a>.</p>
</footer>
</body>
</html>
